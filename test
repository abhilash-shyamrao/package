import { render, screen, fireEvent } from '@testing-library/react';
import ReportingGroup from './ReportingGroup'; // Ensure the correct path to your component
import { vi } from 'vitest';

// Mock MetadataService to avoid actual API calls
vi.mock('../../services/MetadataService', () => ({
  getLobs: vi.fn(() => Promise.resolve(['LOB1', 'LOB2'])),
  getRegions: vi.fn(() => Promise.resolve(['Region1', 'Region2'])),
}));

describe('ReportingGroup Component', () => {
  it('should update form values on input change', () => {
    render(<ReportingGroup />);

    // Simulate typing in the name input (casting to HTMLInputElement)
    const nameInput = screen.getByLabelText(/Name/i) as HTMLInputElement;
    fireEvent.blur(nameInput, { target: { value: 'Test Group' } as Partial<EventTarget> });
    expect(nameInput.value).toBe('Test Group');

    // Simulate selecting Line of Business (casting to HTMLSelectElement)
    const lobSelect = screen.getByLabelText(/Line of Business/i) as HTMLSelectElement;
    fireEvent.change(lobSelect, { target: { value: 'LOB1' } as Partial<EventTarget> });
    expect(lobSelect.value).toBe('LOB1');

    // Simulate selecting Region (casting to HTMLSelectElement)
    const regionSelect = screen.getByLabelText(/Region/i) as HTMLSelectElement;
    fireEvent.change(regionSelect, { target: { value: 'Region1' } as Partial<EventTarget> });
    expect(regionSelect.value).toBe('Region1');

    // Simulate typing in the email list input (casting to HTMLInputElement)
    const emailInput = screen.getByLabelText(/Email List/i) as HTMLInputElement;
    fireEvent.blur(emailInput, { target: { value: 'test@example.com' } as Partial<EventTarget> });
    expect(emailInput.value).toBe('test@example.com');
  });

  it('should toggle active and inactive status', () => {
    render(<ReportingGroup />);

    const activeRadio = screen.getByLabelText(/Active/i) as HTMLInputElement;
    const inactiveRadio = screen.getByLabelText(/Inactive/i) as HTMLInputElement;

    // Initially check the "Active" status
    fireEvent.click(activeRadio);
    expect(activeRadio.checked).toBe(true);
    expect(inactiveRadio.checked).toBe(false);

    // Toggle to "Inactive"
    fireEvent.click(inactiveRadio);
    expect(inactiveRadio.checked).toBe(true);
    expect(activeRadio.checked).toBe(false);
  });
});
